@startuml
!include style.puml
skinparam ActivityBackgroundColor LOGIC_COLOR_T1
skinparam ActivityBorderColor LOGIC_COLOR
skinparam ActivityFontSize 15
skinparam ArrowFontSize 12
start
:User executes command;
:Parse command;

if (Command modifies address book?) then (yes)
  :Commit current state\n(Model#commit());
  :Execute command;
  if (Command execution successful?) then (yes)
    :Save to storage;
    :Return CommandResult;
  else (no)
    :Rollback last commit\n(Model#rollbackLastCommit());
    :Throw CommandException;
  endif
else (no)
  :Execute command;
  :Return CommandResult;
  note right
    Read-only commands
    (e.g., list, find)
    do not commit state
  end note
endif

stop
@enduml
