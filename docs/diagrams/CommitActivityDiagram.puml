@startuml
!include style.puml
skinparam ActivityBackgroundColor LOGIC_COLOR_T1
skinparam ActivityBorderColor LOGIC_COLOR
skinparam ActivityFontSize 15
skinparam ArrowFontSize 12
start
:User executes command;
:Parse command;

if () then ([Command modifies address book])
  :Commit current state\n(Model#commit());
  :Execute command;
  if () then ([Command execution successful])
    :Save to storage;
    :Return CommandResult;
  else ([else])
    :Rollback last commit\n(Model#rollbackLastCommit());
    :Throw CommandException;
  endif
else ([else])
  :Execute command;
  :Return CommandResult;
  note right
    Read-only commands
    (e.g., list, find)
    do not commit state
  end note
endif

stop
@enduml
